{"ast":null,"code":"const State = {\n  loading: 0,\n  loaded: 1,\n  error: 2\n};\nexport class ImageManager {\n  constructor(options) {\n    this.el = options.el;\n    this.src = options.src;\n    this.state = 0;\n    this.loading = options.loading;\n    this.error = options.error;\n    this.render(this.src);\n  }\n  render(src) {\n    this.el.setAttribute('src', src);\n  }\n  load(next) {\n    if (this.state > 0) {\n      return;\n    }\n    this.renderSrc(next);\n  }\n  renderSrc(next) {\n    this.loadImage(this.src).then(() => {\n      this.state = 1;\n      this.render(this.src);\n      next && next();\n    }).catch(e => {\n      this.state = State.error;\n      this.render(this.error);\n      console.warn(`load failed with src image(${this.src}) and the error msg is ${e.message}`);\n      next && next();\n    });\n  }\n  loadImage(src) {\n    return new Promise((resolve, reject) => {\n      const image = new Image();\n      image.onload = function () {\n        resolve();\n        dispose();\n      };\n      image.onerror = function (e) {\n        reject(e);\n        dispose();\n      };\n      image.src = src;\n      function dispose() {\n        image.onload = image.onerror = null;\n      }\n    });\n  }\n}","map":{"version":3,"names":["State","loading","loaded","error","ImageManager","constructor","options","el","src","state","render","setAttribute","load","next","renderSrc","loadImage","then","catch","e","console","warn","message","Promise","resolve","reject","image","Image","onload","dispose","onerror"],"sources":["D:/lin_hai_bo_ke/qian_duan_2/src/Class/ImageManager.js"],"sourcesContent":["const State = {\r\n    loading: 0,\r\n    loaded: 1,\r\n    error: 2\r\n}\r\n\r\nexport class ImageManager {\r\n    constructor(options) {\r\n        this.el = options.el\r\n        this.src = options.src\r\n        this.state =0\r\n        this.loading = options.loading\r\n        this.error = options.error\r\n        this.render(this.src)\r\n    }\r\n    render(src) {\r\n        this.el.setAttribute('src', src)\r\n    }\r\n    load(next) {\r\n        if (this.state>0) {\r\n            return\r\n        }\r\n        this.renderSrc(next)\r\n    }\r\n    renderSrc(next) {\r\n        this.loadImage(this.src).then(() => {\r\n            this.state = 1\r\n            this.render(this.src)\r\n            next && next()\r\n        }).catch((e) => {\r\n            this.state = State.error\r\n            this.render(this.error)\r\n            console.warn(`load failed with src image(${this.src}) and the error msg is ${e.message}`)\r\n            next && next()\r\n        })\r\n    }\r\n    loadImage (src) {\r\n        return new Promise((resolve, reject) => {\r\n            const image = new Image()\r\n            image.onload = function () {resolve();dispose()}\r\n            image.onerror = function (e) {reject(e);dispose()}\r\n            image.src = src\r\n            function dispose() {image.onload = image.onerror = null}\r\n        })\r\n    }\r\n\r\n}\r\n"],"mappings":"AAAA,MAAMA,KAAK,GAAG;EACVC,OAAO,EAAE,CAAC;EACVC,MAAM,EAAE,CAAC;EACTC,KAAK,EAAE;AACX,CAAC;AAED,OAAO,MAAMC,YAAY,CAAC;EACtBC,WAAWA,CAACC,OAAO,EAAE;IACjB,IAAI,CAACC,EAAE,GAAGD,OAAO,CAACC,EAAE;IACpB,IAAI,CAACC,GAAG,GAAGF,OAAO,CAACE,GAAG;IACtB,IAAI,CAACC,KAAK,GAAE,CAAC;IACb,IAAI,CAACR,OAAO,GAAGK,OAAO,CAACL,OAAO;IAC9B,IAAI,CAACE,KAAK,GAAGG,OAAO,CAACH,KAAK;IAC1B,IAAI,CAACO,MAAM,CAAC,IAAI,CAACF,GAAG,CAAC;EACzB;EACAE,MAAMA,CAACF,GAAG,EAAE;IACR,IAAI,CAACD,EAAE,CAACI,YAAY,CAAC,KAAK,EAAEH,GAAG,CAAC;EACpC;EACAI,IAAIA,CAACC,IAAI,EAAE;IACP,IAAI,IAAI,CAACJ,KAAK,GAAC,CAAC,EAAE;MACd;IACJ;IACA,IAAI,CAACK,SAAS,CAACD,IAAI,CAAC;EACxB;EACAC,SAASA,CAACD,IAAI,EAAE;IACZ,IAAI,CAACE,SAAS,CAAC,IAAI,CAACP,GAAG,CAAC,CAACQ,IAAI,CAAC,MAAM;MAChC,IAAI,CAACP,KAAK,GAAG,CAAC;MACd,IAAI,CAACC,MAAM,CAAC,IAAI,CAACF,GAAG,CAAC;MACrBK,IAAI,IAAIA,IAAI,CAAC,CAAC;IAClB,CAAC,CAAC,CAACI,KAAK,CAAEC,CAAC,IAAK;MACZ,IAAI,CAACT,KAAK,GAAGT,KAAK,CAACG,KAAK;MACxB,IAAI,CAACO,MAAM,CAAC,IAAI,CAACP,KAAK,CAAC;MACvBgB,OAAO,CAACC,IAAI,CAAE,8BAA6B,IAAI,CAACZ,GAAI,0BAAyBU,CAAC,CAACG,OAAQ,EAAC,CAAC;MACzFR,IAAI,IAAIA,IAAI,CAAC,CAAC;IAClB,CAAC,CAAC;EACN;EACAE,SAASA,CAAEP,GAAG,EAAE;IACZ,OAAO,IAAIc,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;MACpC,MAAMC,KAAK,GAAG,IAAIC,KAAK,CAAC,CAAC;MACzBD,KAAK,CAACE,MAAM,GAAG,YAAY;QAACJ,OAAO,CAAC,CAAC;QAACK,OAAO,CAAC,CAAC;MAAA,CAAC;MAChDH,KAAK,CAACI,OAAO,GAAG,UAAUX,CAAC,EAAE;QAACM,MAAM,CAACN,CAAC,CAAC;QAACU,OAAO,CAAC,CAAC;MAAA,CAAC;MAClDH,KAAK,CAACjB,GAAG,GAAGA,GAAG;MACf,SAASoB,OAAOA,CAAA,EAAG;QAACH,KAAK,CAACE,MAAM,GAAGF,KAAK,CAACI,OAAO,GAAG,IAAI;MAAA;IAC3D,CAAC,CAAC;EACN;AAEJ"},"metadata":{},"sourceType":"module","externalDependencies":[]}