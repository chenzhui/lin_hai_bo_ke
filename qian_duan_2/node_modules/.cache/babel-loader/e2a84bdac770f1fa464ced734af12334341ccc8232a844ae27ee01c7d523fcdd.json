{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { getCurrentInstance, onMounted, ref } from \"vue\";\nimport axios from \"axios\";\nimport router from \"../Router/First\";\nexport default {\n  setup() {\n    const gci = getCurrentInstance();\n    let typeRef = ref(null);\n    let blogRef = ref(null);\n    let content = ref(null);\n    let file = ref(null);\n    onMounted(async () => {\n      document.title = \"发布博客\";\n      document.documentElement.style.fontSize = document.documentElement.clientWidth / 100 + 'px';\n      gci.data.id = gci.appContext.config.globalProperties.$id;\n      gci.data.avatar = gci.appContext.config.globalProperties.$avatar;\n      axios.get('http://114.55.38.94:8001/SelectKinds').then(res => {\n        gci.data.types = res.data.data;\n      });\n    });\n    return {\n      blogRef,\n      typeRef,\n      content,\n      file\n    };\n  },\n  data() {\n    return {\n      id: \"\",\n      title: \"\",\n      titleOk: true,\n      couldTitle: 30,\n      kind: \"\",\n      couldType: 10,\n      imageUrl: null,\n      types: []\n    };\n  },\n  mounted() {\n    window.DeleteImage = this.DeleteImage;\n    window.addEventListener(\"beforeunload\", this.beforeUnloadHandler, false);\n  },\n  methods: {\n    Save(e) {\n      if (e.keyCode == 65) {\n        this.ReleaseBlog();\n      }\n    },\n    ReleaseBlog() {\n      const that = this;\n      axios.get('http://114.55.38.94:8001/ReleaseBlog', {\n        params: {\n          'id': that.id,\n          'title': that.title,\n          'type': that.kind,\n          'content': that.content.innerHTML\n        }\n      }).then(res => {\n        if (res.data.data == \"发布成功\") {\n          alert(\"发布成功\");\n          router.push('/Index');\n          that.mitt1.emit('Reload');\n        } else {\n          alert(\"发布失败\");\n        }\n      });\n    },\n    AddImage() {\n      let fd = new FormData();\n      fd.append(\"id\", this.id);\n      fd.append(\"file\", this.file.files[0]);\n      const that = this;\n      axios.post(\"http://114.55.38.94:8001/UploadImage\", fd, {\n        headers: {\n          'Content-Type': 'application/x-www-form-urlencoded'\n        }\n      }).then(res => {\n        that.file.value = '';\n        that.content.innerHTML = that.content.innerHTML + \"<div style='display:flex;flex-direction:row'> \" + \"<img src='http://114.55.38.94:8001/picture/\" + res.data.data + \"' style='max-width:300px;max-height:300px;min-width:30px;min-height:30px'>\" + \"<img src='http://114.55.38.94:8001/picture/deleteIcon.png' onclick='DeleteImage()' style='width:2rem;height:2rem;margin-left:2rem;cursor:pointer;'>\" + \"</div>\" + \"<div contentEditable style='width:700px;resize:none;font-size:25px;'></div>\";\n      });\n    },\n    JudgeTitle() {\n      this.ExameTitle();\n      this.couldTitle = 30 - this.title.length;\n    },\n    JudgeType() {\n      this.ExameType();\n      this.couldType = 10 - this.type.length;\n    },\n    ExameTitle() {\n      if (this.title.length != 0) {\n        this.titleOk = true;\n      } else {\n        this.titleOk = false;\n      }\n    },\n    DeleteImage() {\n      event.currentTarget.parentElement.remove();\n      axios.get(\"http://114.55.38.94:8001/DeleteImage\", {\n        params: {\n          id: this.id,\n          imageName: event.currentTarget.parentElement.firstElementChild.getAttribute(\"src\")\n        }\n      }).then(() => {});\n    },\n    ExameType() {\n      if (this.type.length != 0) {\n        this.typeOk = true;\n      } else {\n        this.typeOk = false;\n      }\n    }\n  }\n};","map":{"version":3,"names":["getCurrentInstance","onMounted","ref","axios","router","setup","gci","typeRef","blogRef","content","file","document","title","documentElement","style","fontSize","clientWidth","data","id","appContext","config","globalProperties","$id","avatar","$avatar","get","then","res","types","titleOk","couldTitle","kind","couldType","imageUrl","mounted","window","DeleteImage","addEventListener","beforeUnloadHandler","methods","Save","e","keyCode","ReleaseBlog","that","params","innerHTML","alert","push","mitt1","emit","AddImage","fd","FormData","append","files","post","headers","value","JudgeTitle","ExameTitle","length","JudgeType","ExameType","type","event","currentTarget","parentElement","remove","imageName","firstElementChild","getAttribute","typeOk"],"sources":["D:\\lin_hai_bo_ke\\qian_duan_2\\src\\Views\\Release.vue"],"sourcesContent":["<template>\r\n  <div style=\"display:flex;flex-direction:column;background-color:white;padding-left:2%;padding-top:10px;\">\r\n    <div style=\"display:flex;align-items:center;\">\r\n      <p style=\"font-size:1rem;\">标题:</p>\r\n      <input type=\"text\" @keydown.enter=\"typeRef.focus()\" style=\"resize:none;height:30px;width:50%;border-radius:10px;font-size:1rem;background-color:lightblue;\" maxlength=\"30\" v-model=\"title\" @input=\"JudgeTitle\" @blur=\"ExameTitle\">\r\n      <p v-if=\"!titleOk\" style=\"color:red;margin-left:22%;\">标题不能为空</p>\r\n      <p v-else style=\"margin-left:2%;color:lightblue;\">还可输入{{couldTitle}}字</p>\r\n    </div>\r\n    <div style=\"display:flex;align-items:center;margin-top:1%;\">\r\n      <p>类型:</p>\r\n      <select v-model=\"kind\" style=\"border:black solid 0.1rem;background-color: lightblue;\">\r\n        <option value=\"\">请选择</option>\r\n        <option v-for=\"item in types\" :key=\"item.tId\" :value=\"item.kind\">{{item.kind}}</option>\r\n      </select>\r\n    </div>\r\n    <div style=\"display:flex;\">\r\n      <input type=\"file\" ref=\"file\" accept=\"image/png, image/jpeg, image/gif, image/jpg\" style=\"height:30px;margin-top:10px;margin-left:2%;opacity:1\"/>\r\n      <button @click=\"AddImage\" style=\"cursor:pointer;background-color:deepskyblue;border-radius:5px;color:white;width:10%;height:30px;margin-top:10px;font-size:1rem;\">添加图片</button>\r\n    </div>\r\n    <div ref=\"content\" style=\"border:solid 1px lightgray;margin-top:10px;width:50%;min-height:700px;\" @keydown.ctrl=\"Save\">\r\n      <div  contenteditable style=\"width:100%;min-height:50px;resize:none;font-size:1rem;\"></div>\r\n    </div>\r\n    <button @click=\"ReleaseBlog\" style=\"background-color:deepskyblue;height:50px;width:20%;cursor:pointer;border-radius:5px;margin-top:30px;color:white;font-size:2rem;margin-left:15%\">提交</button>\r\n  </div>\r\n</template>\r\n<script>\r\nimport {getCurrentInstance,onMounted, ref} from \"vue\";\r\nimport axios from \"axios\";\r\nimport router from \"../Router/First\";\r\nexport default {\r\nsetup(){\r\n  const gci = getCurrentInstance()\r\n  let typeRef = ref(null)\r\n  let blogRef = ref(null)\r\n  let content = ref(null)\r\n  let file    = ref(null)\r\n  onMounted(async()=>{\r\n    document.title = \"发布博客\"\r\n    document.documentElement.style.fontSize = document.documentElement.clientWidth/100 + 'px';\r\n    gci.data.id = gci.appContext.config.globalProperties.$id\r\n    gci.data.avatar = gci.appContext.config.globalProperties.$avatar\r\n    axios.get('http://114.55.38.94:8001/SelectKinds').then((res)=>{gci.data.types=res.data.data})\r\n  })\r\n  return {\r\n    blogRef,typeRef,content,file\r\n  }\r\n},\r\ndata(){\r\n  return {\r\n    id: \"\",\r\n    title: \"\",\r\n    titleOk: true,\r\n    couldTitle: 30,\r\n    kind:\"\",\r\n    couldType: 10,\r\n    imageUrl:null,\r\n    types:[],\r\n  }\r\n},\r\nmounted(){\r\n  window.DeleteImage=this.DeleteImage\r\n  window.addEventListener(\"beforeunload\", this.beforeUnloadHandler, false)\r\n},\r\n  methods:{\r\n    \r\n  Save(e){\r\n    if(e.keyCode==65){\r\n      this.ReleaseBlog()\r\n    }\r\n  },\r\n  ReleaseBlog(){\r\n    const that=this\r\n    axios.get('http://114.55.38.94:8001/ReleaseBlog',{params:{'id':that.id,'title':that.title,'type':that.kind,'content':that.content.innerHTML}}).then((res)=>{\r\n      if(res.data.data ==\"发布成功\"){\r\n        alert(\"发布成功\")\r\n        router.push('/Index')\r\n        that.mitt1.emit('Reload')\r\n      }else{alert(\"发布失败\")}})\r\n  },\r\n  AddImage(){\r\n    let fd = new FormData\r\n    fd.append(\"id\",this.id)\r\n    fd.append(\"file\",this.file.files[0])\r\n    const that=this\r\n    axios.post(\"http://114.55.38.94:8001/UploadImage\",fd,{headers: {'Content-Type': 'application/x-www-form-urlencoded'}}).then((res)=>{\r\n      that.file.value=''\r\n      that.content.innerHTML=that.content.innerHTML+\r\n          \"<div style='display:flex;flex-direction:row'> \" +\r\n            \"<img src='http://114.55.38.94:8001/picture/\"+res.data.data+\"' style='max-width:300px;max-height:300px;min-width:30px;min-height:30px'>\" +\r\n            \"<img src='http://114.55.38.94:8001/picture/deleteIcon.png' onclick='DeleteImage()' style='width:2rem;height:2rem;margin-left:2rem;cursor:pointer;'>\"+\r\n          \"</div>\" +\r\n          \"<div contentEditable style='width:700px;resize:none;font-size:25px;'></div>\"\r\n    })\r\n  },\r\n  JudgeTitle() {\r\n    this.ExameTitle()\r\n    this.couldTitle = 30 - this.title.length\r\n  },\r\n  JudgeType() {\r\n    this.ExameType()\r\n    this.couldType = 10 - this.type.length\r\n  },\r\n  ExameTitle() {\r\n    if(this.title.length != 0) {\r\n      this.titleOk = true\r\n    } else {\r\n      this.titleOk = false\r\n    }\r\n  },\r\n  DeleteImage(){\r\n    event.currentTarget.parentElement.remove()\r\n    axios.get(\"http://114.55.38.94:8001/DeleteImage\",{params:{id:this.id,imageName:event.currentTarget.parentElement.firstElementChild.getAttribute(\"src\")}}).then(()=>{})\r\n  },\r\n  ExameType(){\r\n    if(this.type.length != 0) {\r\n      this.typeOk = true\r\n    } else {\r\n      this.typeOk = false\r\n    }\r\n  },\r\n}\r\n}\r\n</script><style scoped></style>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}