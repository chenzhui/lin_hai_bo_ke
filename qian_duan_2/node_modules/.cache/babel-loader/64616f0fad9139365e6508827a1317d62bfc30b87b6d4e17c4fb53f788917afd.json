{"ast":null,"code":"import { getCurrentInstance, onMounted, ref } from \"vue\";\nimport axios from \"axios\";\nimport router from \"../Router/First\";\nexport default {\n  setup() {\n    document.title = \"修改博客\";\n    const gci = getCurrentInstance();\n    let titleRef = ref(null);\n    let typeRef = ref(null);\n    let contentRef = ref(null);\n    let file = ref(null);\n    onMounted(async () => {\n      gci.data.id = 1; //gci.appContext.config.globalProperties.$id\n      gci.data.blogId = router.currentRoute.value.query.blogId;\n      axios.get('http://114.55.38.94/api/SelectKinds').then(res => {\n        gci.data.types = res.data.data;\n      });\n      await axios.get('http://114.55.38.94/api/GetBlog', {\n        params: {\n          \"blogId\": gci.data.blogId\n        }\n      }).then(function (res) {\n        gci.data.blogData = res.data.data;\n      });\n      gci.data.kind = gci.data.blogData.type;\n      console.log(gci.data.kind);\n    });\n    return {\n      titleRef,\n      typeRef,\n      contentRef,\n      file\n    };\n  },\n  data() {\n    return {\n      blogData: {},\n      types: [],\n      titleOk: true,\n      typeOk: true,\n      fixOk: false,\n      kind: \"\"\n    };\n  },\n  mounted() {\n    window.DeleteImage = this.DeleteImage;\n    //window.addEventListener(\"beforeunload\", (event) => this.Remind(event))\n  },\n\n  methods: {\n    Remind(event) {\n      console.log(this.fixOk);\n      if (this.fixOk == false) {\n        event.preventDefault();\n        return \"\";\n      }\n    },\n    CloseWindow() {\n      console.log(\"CloseWindow\");\n      if (this.fixOk == false) {\n        console.log(\"false\");\n        let leave = confirm(\"您所作的修改还未保存，是否离开\");\n        if (leave == true) {\n          window.close();\n        }\n      } else {\n        console.log(\"true\");\n        this.$router.go(-1);\n      }\n    },\n    Save(e) {\n      if (e.keyCode == 65) {\n        this.FixBlog();\n      }\n    },\n    FixBlog() {\n      let sureFix = confirm(\"点击“确定”修改,点击”取消“停止\");\n      if (sureFix == true) {\n        const that = this;\n        axios.post(\"http://114.55.38.94/api/FixBlog\", {\n          params: {\n            'id': that.id,\n            'title': that.title,\n            'type': that.kind,\n            'content': that.content.innerHTML\n          }\n        }).then(async function (res) {\n          if (res.data.data == \"修改博客成功\") {\n            that.fixOk = true;\n            await alert(\"修改博客成功\");\n            console.log(\"修改博客成功\");\n            that.CloseWindow();\n          } else {\n            alert(\"系统繁忙,请稍后重试\");\n          }\n        });\n      }\n      window.close();\n    },\n    AddImage() {\n      let fd = new FormData();\n      fd.append(\"id\", this.id);\n      fd.append(\"file\", this.file.files[0]);\n      const that = this;\n      axios.post(\"http://114.55.38.94/api/UploadImage\", fd, {\n        headers: {\n          'Content-Type': 'application/x-www-form-urlencoded'\n        }\n      }).then(res => {\n        that.file.value = '';\n        that.content.innerHTML = that.content.innerHTML + \"<img src='http://114.55.38.94/api/picture/\" + res.data.data + \"' style='max-width:300px;max-height:300px;min-width:30px;min-height:30px'>\" + \"<div contentEditable style='margin-top:20px;width:700px;min-height:100px;resize:none;font-size:25px;'></div>\";\n      });\n    },\n    DeleteImage() {\n      event.currentTarget.parentElement.remove();\n      axios.get(\"http://114.55.38.94/api/DeleteImage\", {\n        params: {\n          id: this.id,\n          imageName: event.currentTarget.parentElement.firstElementChild.getAttribute(\"src\")\n        }\n      }).then(() => {});\n    }\n  }\n};","map":{"version":3,"names":["getCurrentInstance","onMounted","ref","axios","router","setup","document","title","gci","titleRef","typeRef","contentRef","file","data","id","blogId","currentRoute","value","query","get","then","res","types","params","blogData","kind","type","console","log","titleOk","typeOk","fixOk","mounted","window","DeleteImage","methods","Remind","event","preventDefault","CloseWindow","leave","confirm","close","$router","go","Save","e","keyCode","FixBlog","sureFix","that","post","content","innerHTML","alert","AddImage","fd","FormData","append","files","headers","currentTarget","parentElement","remove","imageName","firstElementChild","getAttribute"],"sources":["D:\\lin_hai_bo_ke\\qian_duan_2\\src\\Views\\Fixing.vue"],"sourcesContent":["<template>\r\n    <div style=\"display:flex;flex-direction:column;background-color:white;width:1000px;padding-top:10px;\">\r\n      <div style=\"display:flex;align-items:center;\">\r\n        <p style=\"font-size:30px;\">标题:</p>\r\n        <input type=\"text\" ref=\"titleRef\" @keydown.enter=\"typeRef.focus()\" style=\"resize:none;height:30px;width:600px;border-radius:10px;font-size:25px;background-color:lightblue;\" maxlength=\"30\" v-model=\"blogData.title\">\r\n      </div>\r\n      <!--<div style=\"display:flex;align-items:center;margin-top:10px;\">\r\n        <p>类型:</p>\r\n        <input  ref=\"typeRef\" type=\"text\" v-model=\"blogData.type\" style=\"background-color:lightgreen;width:140px;height:30px;border-radius:10px;\" maxlength=\"10\">\r\n      </div>-->\r\n      <div style=\"display:flex;align-items:center;margin-top:1%;\">\r\n        <p>类型:</p>\r\n        <select v-model=\"kind\" style=\"border:black solid 0.1rem;background-color: lightblue;\">\r\n          <option value=\"\">123</option>\r\n          <option v-for=\"item in types\" :key=\"item.tId\" :value=\"item.kind\">{{item.kind}}</option>\r\n        </select>\r\n      </div>\r\n      <div style=\"display:flex;\">\r\n        <input type=\"file\" ref=\"file\" accept=\"image/png, image/jpeg, image/gif, image/jpg\" style=\"height:30px;margin-top:10px;margin-left:2%;opacity:1\"/>\r\n        <button @click=\"AddImage\" style=\"cursor:pointer;background-color:deepskyblue;border-radius:5px;color:white;width:10%;height:30px;margin-top:10px;font-size:1rem;\">添加图片</button>\r\n      </div>\r\n      <div ref=\"contentRef\" style=\"border-top:solid 1px lightgray;margin-top:1rem;width:60rem;border-bottom:solid 1px lightgray;min-height:700px;\" @keydown.ctrl=\"Save\">\r\n        <div  contenteditable v-html=\"blogData.content\" style=\"width:60rem;min-height:50px;resize:none;font-size:20px;\"></div>\r\n      </div>\r\n      <button @click=\"FixBlog\" style=\"align-self:center;background-color:deepskyblue;height:50px;width:200px;cursor:pointer;border-radius:5px;margin-top:30px;color:white;font-size:30px;\">修改</button>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport {getCurrentInstance, onMounted, ref} from \"vue\";\r\nimport axios from \"axios\";\r\nimport router from \"../Router/First\";\r\nexport default {\r\nsetup(){\r\n  document.title=\"修改博客\"\r\n  const gci=getCurrentInstance()\r\n  let titleRef=ref(null)\r\n  let typeRef=ref(null)\r\n  let contentRef=ref(null)\r\n  let file    = ref(null)\r\n  onMounted(async ()=>{\r\n    gci.data.id =1//gci.appContext.config.globalProperties.$id\r\n    gci.data.blogId=router.currentRoute.value.query.blogId\r\n    axios.get('http://114.55.38.94/api/SelectKinds').then((res)=>{gci.data.types=res.data.data})\r\n    await axios.get('http://114.55.38.94/api/GetBlog',{params:{\"blogId\":gci.data.blogId}}).then(function (res){\r\n      gci.data.blogData=res.data.data\r\n    })\r\n    gci.data.kind=gci.data.blogData.type;\r\n    console.log(gci.data.kind)\r\n  })\r\n  return{\r\n    titleRef,typeRef,contentRef,file\r\n  }\r\n},\r\ndata(){\r\n  return{\r\n    blogData:{},\r\n    types:[],\r\n    titleOk:true,\r\n    typeOk:true,\r\n    fixOk:false,\r\n    kind:\"\",\r\n  }\r\n},\r\nmounted(){\r\n  window.DeleteImage=this.DeleteImage\r\n  //window.addEventListener(\"beforeunload\", (event) => this.Remind(event))\r\n},\r\nmethods:{\r\nRemind(event){\r\n  console.log(this.fixOk)\r\n  if(this.fixOk==false){\r\n    event.preventDefault()\r\n    return \"\"\r\n  }\r\n},\r\nCloseWindow(){\r\n  console.log(\"CloseWindow\")\r\n  if(this.fixOk==false){\r\n    console.log(\"false\")\r\n    let leave=confirm(\"您所作的修改还未保存，是否离开\")\r\n    if(leave==true){\r\n      window.close()\r\n    }\r\n  }else{\r\n    console.log(\"true\")\r\n    this.$router.go(-1)\r\n  }\r\n},\r\nSave(e){\r\n  if(e.keyCode==65){\r\n    this.FixBlog()\r\n  }\r\n},\r\nFixBlog(){\r\n  let sureFix=confirm(\"点击“确定”修改,点击”取消“停止\")\r\n  if(sureFix==true){\r\n    const that=this\r\n    axios.post(\"http://114.55.38.94/api/FixBlog\",{params:{'id':that.id,'title':that.title,'type':that.kind,'content':that.content.innerHTML}}).then(async function (res){\r\n      if(res.data.data==\"修改博客成功\"){\r\n        that.fixOk=true\r\n        await alert(\"修改博客成功\")\r\n        console.log(\"修改博客成功\")\r\n        that.CloseWindow()\r\n      }else{alert(\"系统繁忙,请稍后重试\")}\r\n    })\r\n  }\r\n  window.close()\r\n},\r\nAddImage(){\r\n  let fd = new FormData\r\n  fd.append(\"id\",this.id)\r\n  fd.append(\"file\",this.file.files[0])\r\n  const that=this\r\n  axios.post(\"http://114.55.38.94/api/UploadImage\",fd,{headers: {'Content-Type': 'application/x-www-form-urlencoded'}}).then((res)=>{\r\n    that.file.value=''\r\n    that.content.innerHTML=that.content.innerHTML+\"<img src='http://114.55.38.94/api/picture/\"+res.data.data+\"' style='max-width:300px;max-height:300px;min-width:30px;min-height:30px'>\"+ \"<div contentEditable style='margin-top:20px;width:700px;min-height:100px;resize:none;font-size:25px;'></div>\"\r\n  })\r\n},\r\nDeleteImage(){\r\n  event.currentTarget.parentElement.remove()\r\n  axios.get(\"http://114.55.38.94/api/DeleteImage\",{params:{id:this.id,imageName:event.currentTarget.parentElement.firstElementChild.getAttribute(\"src\")}}).then(()=>{})\r\n},\r\n},\r\n}\r\n</script>\r\n<style scoped></style>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}